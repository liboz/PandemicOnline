<div id="main-holder">
    <div id="map-holder">
        <svg>
            <g>
                <rect [ngClass]="'background'" [attr.width]="w" [attr.height]="h" x="0" y="0"></rect>
                <path [attr.d]="path(feature)" *ngFor="let feature of features" [ngClass]="'landmass'"></path>
                <g [app-link]="link" *ngFor="let link of links"></g>
                <g [app-node]="node" *ngFor="let node of nodes" (selected)="onSelectedNode($event)"
                    [isMoving]="isMoving"></g>
            </g>
        </svg>
    </div>
    <div id="player-holder">
        <ng-container *ngIf="hasStarted()">
            <div *ngFor="let player of game.players">
                <div [ngStyle]="{'background': bgColor(player.id), 'color': 'white' }">
                    Player {{ player.id }} ({{player.name}}) - {{ player.role}}
                </div>
                <app-player-hand [hand]="player.hand" [game]="game">
                </app-player-hand>
            </div>
        </ng-container>
    </div>
</div>
<button *ngIf="!hasStarted()" (click)="onStart()">Start Game</button>
<div id="bottom-holder">
    <div *ngIf="hasStarted()" id="bottom-left">
        {{ game.player_index !== player_index ? 'Player ' + game.player_index + '\'s (' + game.players[game.player_index].name + ')' : 'Your' }}  turn
        <br>
        Actions Left: {{game.turns_left}}
        <br>
        <div *ngIf="game.player_index === player_index">
            <button [disabled]="cannotDoPrimaryAction() && !isMoving"
                (click)="onMove()">{{ isMoving ? 'Cancel' : 'Move' }}</button>
            <button [disabled]="!game.can_build_research_station || cannotDoPrimaryAction()" (click)="onBuild()">Build A
                Research Station</button>
            <button [disabled]="!game.can_treat || cannotDoPrimaryAction()" (click)="onTreat()">Treat Disease</button>
            <button [disabled]="(!game.can_give && !game.can_take) || (cannotDoPrimaryAction() && !shareCardChoices)"
                (click)="onShare()">{{ shareCardChoices ? 'Cancel' : 'Share Knowledge' }}</button>
            <button [disabled]="!game.can_cure || (cannotDoPrimaryAction() && !cureColorCards)"
                (click)="onDiscover()">Discover
                Cure</button>
            <button *ngIf="cureColorCards" (click)="cancelDiscover()">Cancel Discover Cure</button>
            <button [disabled]="cannotDoPrimaryAction()" (click)="onPass()">Pass Turn</button>
            <button [disabled]="!mustDiscard() || !discardEnough()" (click)="discardSelectedCards()">Discard
                Selected</button>
        </div>
        <div *ngIf="mustDiscard()">YOU MUST DISCARD TO 7 CARDS</div>
        <div *ngIf="treatColorChoices">
            <div *ngFor="let cube of treatColorChoices">
                <button (click)="treat(cube)">
                    Treat {{cube}}
                </button>
            </div>
        </div>
        <div *ngIf="shareCardChoices">
            <div *ngFor="let player of shareCardChoices">
                <button (click)="share(player)">
                    Give Player {{player}} the {{game.players[game.player_index].location}} card
                </button>
            </div>
        </div>
        <br>
        <div *ngIf="player_name">
            <div *ngIf="!cureColorCards">
                Your ({{ game.players[player_index].name + ': ' + game.players[player_index].role }}) Hand
                <app-player-hand [hand]="game.players[player_index].hand" [game]="game"
                    (onSelect)="onSelectedCard($event)"></app-player-hand>
            </div>
            <div *ngIf="cureColorCards">
                SELECT THE CARDS TO NOT USE FOR DISCOVERING
                <app-player-hand [hand]="cureColorCards" [game]="game" (onSelect)="onSelectedCard($event)"
                    [cardLimit]="game.cards_needed_to_cure">
                </app-player-hand>
            </div>
        </div>
    </div>
    <br>
    <div *ngIf="hasStarted()" id="bottom-middle">
        <div>
            Outbreak Counter: {{ game.outbreak_counter }}
        </div>
        <div>
            Infection Rate: {{ game.infection_rate[game.infection_rate_index] }}
        </div>
        <div>
            Cubes:
            <ul>
                <li *ngFor="let color of objectKeys(game.cubes)">
                    {{color + ' : ' + game.cubes[color]}}
                </li>
            </ul>
        </div>
        <div>
            Cured:
            <ul>
                <li *ngFor="let color of objectKeys(game.cured)">
                    {{color + ' : ' + game.cured[color]}}
                </li>
            </ul>
        </div>
    </div>

    <div *ngIf="hasStarted()" id="bottom-log">
        <div id="log">
            Game Log:
            <ul>
                <li *ngFor="let item of game.log.slice().reverse()">
                    {{ item }}
                </li>
            </ul>
        </div>
    </div>

    <div *ngIf="hasStarted()" id="bottom-right">
        <div>
            Infection Deck Faceup:
            <app-player-hand [hand]="game.faceup_deck" [game]="game">
            </app-player-hand>
        </div>
    </div>
</div>